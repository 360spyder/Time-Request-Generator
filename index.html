<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://getbootstrap.com/docs/3.3/dist/css/bootstrap.min.css">

    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.3/jquery.timepicker.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.3/jquery.timepicker.css" />

    <script>
      $( function() {
        $( ".datepicker" ).datepicker({
          changeMonth: true,
          changeYear:  true,
          dateFormat:  'yy/mm/dd',
          onSelect:      timeChange
        });

        $('input.timepicker').timepicker({
          timeFormat: 'HHmm',
          // year, month, day and seconds are not important
          minTime: new Date(0, 0, 0, 6, 0, 0),
          maxTime: new Date(0, 0, 0, 18, 0, 0),
          // time entries start being generated at 6AM but the plugin
          // shows only those within the [minTime, maxTime] interval
          startHour: 6,
          // the value of the first item in the dropdown, when the input
          // field is empty. This overrides the startHour and startMinute
          // options
          startTime: new Date(0, 0, 0, 6, 00, 0),
          // items in the dropdown are separated by at interval minutes
          interval: 30,
          //
          change: timeChange
        });

        if (typeof(Storage) !== "undefined") {
          // Retrieve
          document.getElementById('first_name').value = localStorage.getItem("first_name");
          document.getElementById('last_name').value = localStorage.getItem("last_name");
          document.getElementById('middle_initial').value = localStorage.getItem("middle_initial");
          document.getElementById('prnr').value = localStorage.getItem("prnr");
          document.getElementById('comp').value = localStorage.getItem("comp");
        }
      });
    </script>
  </head>

  <body height='1300px' style='overflow-y: auto'>
    <form class="form-horizontal">
      <div class="well" style='background: #EBF4FA;'>
        <div class="row">
          <div class="col-sm-4">
            <div class="form-group">
              <div class="col-sm-3"><div class="control-label">First Name:</div></div>
              <div class="col-sm-9"><input class="form-control" type="text" id="first_name"></div>
              </br>
              </br>
              <div class="col-sm-3"><div class="control-label">Last Name:</div></div>
              <div class="col-sm-9"><input class="form-control" type="text" id="last_name"></div>
              </br>
              </br>
              <div class="col-sm-1 col-sm-offset-2"><div class="control-label">MI:</div></div>
              <div class="col-sm-2"><input class="form-control" type="text" id="middle_initial"></div>
              <div class="col-sm-1"><div class="control-label">PRNR:</div></div>
              <div class="col-sm-2"><input class="form-control" type="text" id="prnr"></div>
              <div class="col-sm-2"><div class="control-label">Competency:</div></div>
              <div class="col-sm-2"><input class="form-control" type="text" id="comp"></div>
            </div>
          </div>
          <div class="col-sm-4">
            <div class="form-group">
              <div class="col-sm-4"><div class="control-label">Leave Type:</div></div>
              <div class="col-sm-8">
                <select id='leave_type' class='form-control'>
                  <optgroup label="Most Common Leave">
                    <option value="LA - Leave Annual">LA - Leave Annual</option>
                    <option value="LS - Leave Sick">LS - Leave Sick</option>
                    <option value="CD - Credit Hours Earned">CD - Credit Hours Earned</option>
                    <option value="CN - Credit Hours Taken">CN - Credit Hours Taken</option>
                    <option value="CE - Comp Time Earned">CE - Comp Time Earned</option>
                    <option value="CT - Comp Time Taken">CT - Comp Time Taken</option>
                    <option value="CB - Comp Travel Earned">CB - Comp Travel Earned</option>
                    <option value="CF - Comp Travel Taken">CF - Comp Travel Taken</option>
                    <option value="TS - Telework">TS - Telework</option>
                  </optgroup>
                  <optgroup label="All Leave Codes">
                    <option value='CA - Religious Taken'>CA - Religious Taken</option>
                    <option value='CB - Travel Compensatory Earned'>CB - Travel Compensatory Earned</option>
                    <option value='CC - Compensatory Call Back'>CC - Compensatory Call Back</option>
                    <option value='CD - Credit Hours Earned (Straight Time)'>CD - Credit Hours Earned (Straight Time)</option>
                    <option value='CE - Compensatory Time Earned (Overtime)'>CE - Compensatory Time Earned (Overtime)</option>
                    <option value='CF - Travel Compensatory Time Taken'>CF - Travel Compensatory Time Taken</option>
                    <option value='CN - Credit Hours Taken'>CN - Credit Hours Taken</option>
                    <option value='CR - Religious Earned (Straight Time)'>CR - Religious Earned (Straight Time)</option>
                    <option value='CT - Compensatory Time Taken'>CT - Compensatory Time Taken</option>
                    <option value='HC - Holiday Call Back'>HC - Holiday Call Back</option>
                    <option value='HF - Holiday Work, First Shift'>HF - Holiday Work, First Shift</option>
                    <option value='HG - Holiday Work (Graded)'>HG - Holiday Work (Graded)</option>
                    <option value='HS - Holiday Work, Second Shift'>HS - Holiday Work, Second Shift</option>
                    <option value='HT - Holiday Work, Third Shift'>HT - Holiday Work, Third Shift</option>
                    <option value='KA - Leave Without Pay'>KA - Leave Without Pay</option>
                    <option value='KB - Suspension'>KB - Suspension</option>
                    <option value='KC - Absent Without Leave'>KC - Absent Without Leave</option>
                    <option value="KD - Worker's Compensation">KD - Worker's Compensation</option>
                    <option value='KE - Furlough'>KE - Furlough</option>
                    <option value='KF - Non Duty'>KF - Non Duty</option>
                    <option value='KG - Military Furlough'>KG - Military Furlough</option>
                    <option value='KM - Missing time - Non-Pay'>KM - Missing time - Non-Pay</option>
                    <option value='LA - Annual Leave'>LA - Annual Leave</option>
                    <option value='LB - Advanced Annual Leave'>LB - Advanced Annual Leave</option>
                    <option value='LC - Court Leave'>LC - Court Leave</option>
                    <option value='LG - Advanced Sick Leave'>LG - Advanced Sick Leave</option>
                    <option value='LH - Holiday'>LH - Holiday</option>
                    <option value='LK - Home Leave'>LK - Home Leave</option>
                    <option value='LM - Military Leave'>LM - Military Leave</option>
                    <option value="LN - Administrative Leave</br><font color='red'>(Includes blood donation, relocation services for PCS, etc.)</font>">LN - Administrative Leave</option>
                    <option value='LO - BRAC RESTORED '>LO - BRAC RESTORED </option>
                    <option value='LP - Annual Restored #3'>LP - Annual Restored #3</option>
                    <option value='LQ - Annual Restored #2'>LQ - Annual Restored #2</option>
                    <option value='LR - Annual Restored #1'>LR - Annual Restored #1</option>
                    <option value='LS - Sick Leave'>LS - Sick Leave</option>
                    <option value="LS - Sick Leave (Family-Friendly)</br><font color='red'>Enter DE or DF in Prem. No. Column</font>">LS - Sick Leave (Family-Friendly)</option>
                    <option value='LT - Traumatic Injury'>LT - Traumatic Injury</option>
                    <option value='LU - Day of Injury '>LU - Day of Injury </option>
                    <option value='LV - Excused Absence'>LV - Excused Absence</option>
                    <option value='LX - Non-Work Paid at Straight Time (Day of Death)'>LX - Non-Work Paid at Straight Time (Day of Death)</option>
                    <option value='LY - Time Off Award'>LY - Time Off Award</option>
                    <option value='L9 - Emergency Leave'>L9 - Emergency Leave</option>
                    <option value='ND - Night Differential'>ND - Night Differential</option>
                    <option value='OA - Additional FLSA'>OA - Additional FLSA</option>
                    <option value='OS - Overtime Scheduled'>OS - Overtime Scheduled</option>
                    <option value='OU - Overtime Unscheduled'>OU - Overtime Unscheduled</option>
                    <option value='OX - Overtime Unscheduled Exc.'>OX - Overtime Unscheduled Exc.</option>
                    <option value='RF - Regular Ungraded First Shift'>RF - Regular Ungraded First Shift</option>
                    <option value='RG - Regular (Graded)'>RG - Regular (Graded)</option>
                    <option value='RS - Regular Ungraded Second Shift'>RS - Regular Ungraded Second Shift</option>
                    <option value='RT - Regular Ungraded Third Shift'>RT - Regular Ungraded Third Shift</option>
                    <option value='SG - Sunday Work (Graded)'>SG - Sunday Work (Graded)</option>
                    <option value='SF - Sunday Ungraded First Shift'>SF - Sunday Ungraded First Shift</option>
                    <option value='SS - Sunday Ungraded Second Shift'>SS - Sunday Ungraded Second Shift</option>
                    <option value='ST - Sunday Ungraded Third Shift'>ST - Sunday Ungraded Third Shift</option>
                  </optgroup>
                  <optgroup label="Premium Codes">
                    <option value='BA - Term Negotiations'>BA - Term Negotiations</option>
                    <option value='BB - Mid-term Negotiations'>BB - Mid-term Negotiations</option>
                    <option value='BD - Labor/Management REL'>BD - Labor/Management REL</option>
                    <option value='BK - Grievance/Appeals'>BK - Grievance/Appeals</option>
                    <option value='DA - FML Birth of Son/Daughter or Care of Newborn'>DA - FML Birth of Son/Daughter or Care of Newborn</option>
                    <option value='DB - FML Adoption or Foster Care'>DB - FML Adoption or Foster Care</option>
                    <option value='DC - FML Care for Spouse, Son, Daughter of Parent with Serious Health Condition'>DC - FML Care for Spouse, Son, Daughter of Parent with Serious Health Condition</option>
                    <option value='DD - FML Serious Health Condition of Employee'>DD - FML Serious Health Condition of Employee</option>
                    <option value='DE - FFL FEFFL Family Care/Bereavement'>DE - FFL FEFFL Family Care/Bereavement</option>
                    <option value='DF - FFL Adoption Related Purposes'>DF - FFL Adoption Related Purposes</option>
                    <option value='DM - FFL Wounded Veteran'>DM - FFL Wounded Veteran</option>
                    <option value='PH - Preventive-health'>PH - Preventive-health</option>
                    <option value='TM - Telework Medical'>TM - Telework Medical</option>
                    <option value='TS - Telework Situational'>TS - Telework Situational</option>
                    <option value='TW - Telework Regular'>TW - Telework Regular</option>
                  </optgroup>
                </select>
              </div>
              </br>
              </br>
              <div class="col-sm-4"><div class="control-label">Date From:</div></div>
              <div class="col-sm-8"><input class="form-control datepicker" type="text" id="date_from"></div>
              </br>
              </br>
              <div class="col-sm-4"><div class="control-label">Date To:</div></div>
              <div class="col-sm-8"><input class="form-control datepicker" type="text" id="date_to"></div>
            </div>
          </div>
          <div class="col-sm-4">
            <div class="form-group">
              <div class="col-sm-4"><div class="control-label">Hours:</div></div>
              <div class="col-sm-8"><input class="form-control" type="text" id="hours"></div>
              </br>
              </br>
              <div class="col-sm-4"><div class="control-label">Time From:</div></div>
              <div class="col-sm-8"><input class="form-control timepicker" type="text" id="time_from"></div>
              </br>
              </br>
              <div class="col-sm-4"><div class="control-label">Time To:</div></div>
              <div class="col-sm-8"><input class="form-control" type="text" id="time_to" readonly='true'></div>
            </div>
          </div>
        </div>
        <div class='row'>
          <div class='col-sm-12'>
            <div class="form-group">
              <div class='col-sm-2'><div class='control-label'>Reason for Leave:</div></div>
              <div class="col-sm-8"><textarea class="form-control" id="reason" rows="3"></textarea></div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-2 col-sm-offset-5">
            <div class="text-center"><a class="btn btn-primary btn-block" href='#' onClick="javascript:return generate()">Generate</a></div>
          </div>
        </div>
      </div>
      <div class='container'>
        <div class="well">
          <table class='table'>
            <tr>
              <th>Subject:</th>
              <td><div id='subject'></div><input id='subject_copy' style='display: none' type='text'></td>
              <td><button class='pull-right' type='button' onclick="copySubject()"><span class='glyphicon glyphicon-copy'></span></button></td>
            </tr>
            <tr>
              <th>Body:</th>
              <td><div id='body'></div></td>
              <td><button class='pull-right' type='button' onclick="copyBody()"><span class='glyphicon glyphicon-copy'></span></button></td>
            </tr>
          </table>
        </div>
      </div>
    </form>
  </body>
  <footer style='position: absolute; bottom: 0; width: 100%;'>
    <div class='well' style='background: #000; color: #FFF; margin: 0; border-radius: 0;'>
    <div class='container'>
      <div class='row'>
        <div class='col-sm-4'>SPAWAR Request Time Generator</div>
        <div class='col-sm-4'><div class='text-center'>Christopher Nuhn - christopher.nuhn@navy.mil</div></div>
        <div class='col-sm-4'><a class='pull-right' href='https://github.com/360spyder/Time-Request-Generator'>Version 1.0</a></div>
      </div>
    </div>
    </div>
  </footer>
  <script>
    function generate() {
      var first_name = document.getElementById('first_name').value.toUpperCase();
      var last_name = document.getElementById('last_name').value.toUpperCase();
      var middle_initial = document.getElementById('middle_initial').value.toUpperCase();
      var PRNR = document.getElementById('prnr').value;
      var comp = document.getElementById('comp').value;

      var reason = document.getElementById('reason').value;
      var leave_type = document.getElementById('leave_type').value;
      var hours = document.getElementById('hours').value;

      var date_from = document.getElementById('date_from').value.split('/').join('');
      var date_to = document.getElementById('date_to').value.split('/').join('');
      var d = new Date(document.getElementById('date_from').value);

      // Slice date_from to calculate next Saturday
      var  year = parseInt(date_from.slice(0,4));
      var month = parseInt(date_from.slice(4,6));
      var   day = parseInt(date_from.slice(6,8)) + (6 - d.getDay());

      // Find days in the current month to see if there is overflow
      var days_in_month = parseInt(new Date(year, month, 0).getDate());

      // If overflow, handle day month year shifts
      if (day > days_in_month) {
        day = day % days_in_month;
        month = month + 1;

        if (month > 12) {
          year = year + 1;
          month = month % 12;
        };
      };

      var saturday = ('0000' + year.toString()).slice(-4) + ('00' + month.toString()).slice(-2) + ('00' + day.toString()).slice(-2);

      var time_from = document.getElementById('time_from').value;
      var time_to = document.getElementById('time_to').value;

      document.getElementById('subject').innerHTML = `${PRNR}_${last_name}_${first_name}_${middle_initial}_${comp}_${saturday}_${leave_type.slice(0,2)}_${hours}HRS`;
      document.getElementById('body').innerHTML = `
        Request for ${leave_type.slice(5)}</br>
        ${(reason != '') ? reason.replace(/(?:\r\n|\r|\n)/g, '</br>') + '</br>': ''}
        </br>
        <table>
          <tr>
            <td>PRNR:</td>
            <td>${PRNR}</td>
          </tr>
          <tr>
            <td>Date From:</td>
            <td>${date_from}</td>
          </tr>
          <tr>
            <td>Date To:</td>
            <td>${date_to}</td>
          </tr>
          <tr>
            <td>Time From:</td>
            <td>${time_from}</td>
          </tr>
          <tr>
            <td>Time To:</td>
            <td>${time_to}</td>
          </tr>
          <tr>
            <td>Hours:</td>
            <td>${hours}</td>
          </tr>
          <tr>
            <td>Leave Type:</td>
            <td>${leave_type.slice(0,2)}</td>
          </tr>
        </table>
        </br>
        [LA - Annual, LS - Sick, CD - Credit Earned, CN - Credit Taken, CB - Travel Comp Earned, CF - Travel Comp Taken]
      `;

      if (typeof(Storage) !== "undefined") {
        // Store
        localStorage.setItem("first_name", first_name);
        localStorage.setItem("last_name", last_name);
        localStorage.setItem("middle_initial", middle_initial);
        localStorage.setItem("prnr", PRNR);
        localStorage.setItem("comp", comp);
      };

      return false;
    };
  </script>
  <script>
    document.getElementById('hours').addEventListener("change", timeChange);
    document.getElementById('leave_type').addEventListener("change", generate);

    function timeChange() {
      var time_from = parseInt(document.getElementById('time_from').value);
      var date_from = new Date(document.getElementById('date_from').value);
      var date_to = new Date(document.getElementById('date_to').value);

      // Return if Dates are invalid
      if (isNaN(date_from.getTime()) == true){document.getElementById('time_to').value = "A Date From is Invalid"; return;};
      if (isNaN(date_to.getTime()) == true){document.getElementById('time_to').value = "A Date To is Invalid"; return;};

      var oneDay = 24*60*60*1000; // hours*minutes*seconds*milliseconds
      var days = Math.round(Math.abs((date_from.getTime() - date_to.getTime())/(oneDay))) + 1;
      var total_hours = parseFloat(document.getElementById('hours').value);
      var hours_per_day = (total_hours / days).toString();
      var hours = hours_per_day.split('.')[0] * 100

      if (hours_per_day.split('.').length == 2) {
        var minutes = Math.round(parseInt((hours_per_day.split('.')[1] + '0').slice(0,2)) / 10 * 6);
      } else {
        var minutes = 0;
      };

      // Return if Time invalid
      if (isNaN(hours) == true || isNaN(minutes) == true){document.getElementById('time_to').value = "A Hours is Invalid"; return;};

      if (parseInt((time_from + minutes).toString().slice(-2)) >= 60) {
        var new_time = time_from + hours + 100 + (minutes - 60);
      } else {
        var new_time = time_from + hours + minutes;
      };
      document.getElementById('time_to').value = ('0000' + new_time).slice(-4);
      generate();
    };
  </script>
  <script>
    function copySubject() {
      var subject = document.getElementById('subject').innerHTML;
      tmp = document.createElement('TEXTAREA');
      tmp.value = subject;
      document.body.appendChild(tmp);
      tmp.select();
      document.execCommand("Copy");
      document.body.removeChild(tmp);
      return false;
    };
    function copyBody() {
      var body = document.getElementById('body').innerHTML;
      body = body.replace(/\s{2,}/g, '');
      body = body.replace(/<br>|<tr>/g, '\r\n');
      body = body.replace(/<\/td>/g, '\t');
      body = body.replace(/<(\/*table|\/*tbody|\/*td|\/*tr)>/g, '');

      tmp = document.createElement('TEXTAREA');
      tmp.value = body;
      document.body.appendChild(tmp);
      tmp.select();
      document.execCommand("Copy");
      document.body.removeChild(tmp);
      return false;
    };
  </script>
</html>
<script>
/*CA Religious Taken
CB Travel Compensatory Earned (Regular Network and Activity)
CC Compensatory Call Back
CD Credit Hours Earned (Straight Time) (Regular Network and Activity)
CE Compensatory Time Earned (Overtime) (Overtime Network and Activity)
CF Travel Compensatory Time Taken
CN Credit Hours Taken
CR Religious Earned (Straight Time) (Regular Network and Activity)
CT Compensatory Time Taken
HC Holiday Call Back (Regular Network and Activity)
HF Holiday Work, First Shift (Regular Network and Activity)
HG Holiday Work (Graded) (Regular Network and Activity)
HS Holiday Work, Second Shift (Regular Network and Activity)
HT Holiday Work, Third Shift (Regular Network and Activity)
KA Leave Without Pay
KB Suspension
KC Absent Without Leave
KD Worker's Compensation
KE Furlough
KF Non Duty
KG Military Furlough
KM Missing time - Non-Pay
LA Annual Leave
LB Advanced Annual Leave
LC Court Leave
LG Advanced Sick Leave
LH Holiday
LK Home Leave
LM Military Leave
LN Administrative Leave (Includes blood donation, relocation services for PCS, etc.)
LO BRAC RESTORED
LP Annual Restored #3
LQ Annual Restored #2
LR Annual Restored #1
LS Sick Leave
LS Sick Leave (Family-Friendly) Enter DE or DF in Prem. No. Column
LT Traumatic Injury
LU Day of Injury
LV Excused Absence
LX Non-Work Paid at Straight Time (Day of Death)
LY Time Off Award
L9 Emergency Leave (Emergency Leave Transfer Program (ELTP) can be used when authorized by the President.  In the event of a major disaster or emergency that results in severe adverse affects for a substantial number of employees, any employee in any agency may donate unused annual leave for transfer to employees of the same or other agencies who are adversely affected by such disaster or emergency. )
ND Night Differential (Regular Network and Activity)
OA Additional FLSA (Overtime Network and Activity)
OS Overtime Scheduled (Overtime Network and Activity)
OU Overtime Unscheduled  (Overtime Network and Activity)
OX Overtime Unscheduled Exc. (Overtime Network and Activity)
RF Regular Ungraded First Shift (Regular Network and Activity)
RG Regular (Graded) (Regular Network and Activity)
RS Regular Ungraded Second Shift (Regular Network and Activity)
RT Regular Ungraded Third Shift (Regular Network and Activity)
SG Sunday Work (Graded) (Regular Network and Activity)
SF Sunday Ungraded First Shift (Regular Network and Activity)
SS Sunday Ungraded Second Shift (Regular Network and Activity)
ST Sunday Ungraded Third Shift (Regular Network and Activity)
*/
</script>
